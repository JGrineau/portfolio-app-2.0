---
---

<!-- Dark Mode Toggle -->
<button
  id="theme-toggle"
  class="rounded-lg cursor-pointer"
  aria-label="Toggle Theme"
>
  <i class="bi"></i>
</button>

<!-- Bootstrap Icons CDN -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
/>

<!-- Early script: prevent flash -->
<script is:inline>
(() => {
  const stored = localStorage.getItem('theme'); // 'light' | 'dark' | 'system'
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const theme = stored || 'system';
  const isDark = theme === 'dark' || (theme === 'system' && prefersDark);
  document.documentElement.classList.toggle('dark', isDark);
})();
</script>

<!-- Main theme toggle script -->
<script type="module">
  function getNextTheme(current) {
  return current === 'light' ? 'dark' : 'light';
}

   function applyTheme(theme) {
    const isDark = theme === 'dark';
    document.documentElement.classList.toggle('dark', isDark);
    localStorage.setItem('theme', theme);

    // Swap logos instantly
    const lightLogo = document.getElementById('logo-light');
    const darkLogo = document.getElementById('logo-dark');
    if (lightLogo && darkLogo) {
      if (isDark) {
        lightLogo.classList.add('hidden');
        darkLogo.classList.remove('hidden');
      } else {
        lightLogo.classList.remove('hidden');
        darkLogo.classList.add('hidden');
      }
    }
  }

  function updateIcon(btn, theme) {
  const icon = btn.querySelector('i');
  icon.className = ''; // reset

  // Determine current appearance
  let isDark;
  if (theme === 'system') {
    isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  } else {
    isDark = theme === 'dark';
  }

  // Show sun if currently dark, moon if currently light
  if (isDark) icon.classList.add('bi', 'bi-brightness-high'); // sun for dark mode
  else icon.classList.add('bi', 'bi-moon-stars'); // moon for light mode

  btn.setAttribute('aria-label', `Toggle Theme (current: ${theme})`);
}

  const btn = document.getElementById('theme-toggle');
  let theme = localStorage.getItem('theme') || 'system';
  updateIcon(btn, theme);

  btn.addEventListener('click', () => {
    theme = getNextTheme(theme);
    applyTheme(theme);
    updateIcon(btn, theme);
  });

  // Watch for OS theme change in system mode
  const media = window.matchMedia('(prefers-color-scheme: dark)');
  media.addEventListener('change', () => {
    if (theme === 'system') applyTheme('system');
  });
</script>
